# 内存空间详细图解

JavaScript 具有自动垃圾回收机制，周期性运行，进行回收内存空间中不在被使用的变量以及资源

内存空间 关系着 **引用数据类型、引用传递、浅复制、深复制以及闭包等等**

说到内存必要提及的便是 三种数据结构 **栈（stack）、队列（queue）、堆（heap）**

### 一、栈

JavaScript 中没有严格意义上区分**栈内存**和**堆内存**

> 栈内存维护**基础数据类型**，堆内存维护**引用数据类型**
> 
> 栈内存是从**地址高位**开始分配，堆内存从**地址低位**开始分配

JavaScript 的执行上下文的执行顺序借用了栈数据结构的存取方式（函数调用栈）

**先进后出**

![截图](https://s1.328888.xyz/2022/04/21/r6wD0.png)

### 二、堆

**树状结构**

### 三、队列

**先进先出**

事件循环（Event Loop）

![截图](https://s1.328888.xyz/2022/04/21/r6KBF.png)

### 四、变量对象（环境记录对象）

JavaScript 的执行上下文生成之后，会创建一个叫做变量对象的特殊对象，囊括上下文中所有的变量以及函数

### 五、引用数据类型与堆内存

例如一些 数组、对象类型的变量 在 变量对象 中以地址（推内存中实际存储地址）的形保存

```javascript
var a1 = 0;   // 变量对象
var a2 = 'this is string'; // 变量对象
var a3 = null; // 变量对象

var b = { m: 20 }; // 变量b存在于变量对象中，{m: 20} 作为对象存在于堆内存中
var c = [1, 2, 3]; // 变量c存在于变量对象中，[1, 2, 3] 作为对象存在于堆内存中
```

![截图](https://s1.328888.xyz/2022/04/21/r633J.png)

当我们去访问引用数据类型时，实际上是先从变量对象中获取地址引用（或者地址指针）再从堆内存中取数据

### 六、内存空间管理

JavaScript的内存生命周期

- 分配你所需要的内存
- 使用分配到的内存（读、写）
- 不需要时将其释放、归还

```javascript
var a = 20;  // 在内存中给数值变量分配空间
alert(a + 100);  // 使用内存
a = null; // 使用完毕之后，释放内存空间
```

JavaScript 自动垃圾收集机制的原理：就是找出那些不再继续使用的值，然后释放其占用的内存。垃圾收集器会每隔固定的时间段就执行一次释放操作。

最常用的是通过**标记清除**的算法

`a = null` 实际就是释放引用，适当的释放引用可以提高性能
