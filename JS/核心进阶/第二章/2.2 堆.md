# Heap

![img](https://images.xiaozhuanlan.com/photo/2020/aa3a3884d0a5f3f7b76cd81363951c2f.png)

#### äºŒå‰å †

äºŒå‰å †èƒ½å¤Ÿå®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—**ã€ŒPriority Queueã€**ã€‚

Linux å†…æ ¸ä¸­å¯¹å„ä¸ªè¿›ç¨‹çš„è°ƒåº¦åˆ†é…ï¼Œå®šæ—¶å™¨çš„å®ç°åŸç†ï¼ŒReact Fiber çš„ä»»åŠ¡è°ƒåº¦åˆ†é…ï¼Œéƒ½åˆ©ç”¨äº†ä¼˜å…ˆçº§é˜Ÿåˆ—çš„æ€ç»´æ¥è§£å†³é—®é¢˜ã€‚

> äºŒå‰å †ä¸­ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„ï¼Œå¦åˆ™å°±æ— æ³•åˆ¤æ–­ä¼˜å…ˆçº§

äºŒå‰å †æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼šå³åœ¨æ ‘ç»“æ„ä¸­ï¼Œé™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½æ˜¯å®Œæ•´çš„ã€Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ‹¥æœ‰å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹ã€ã€‚å®ƒåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š

- å¤§é¡¶å †ï¼šä»»ä½•çˆ¶èŠ‚ç‚¹çš„é”®å€¼ï¼Œéƒ½å¤§äºç­‰äºä»»ä½•ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚
  
  ![img](https://images.xiaozhuanlan.com/photo/2020/9ecc4c7f0d16204bdbd71610a73732fe.png)

- å°é¡¶å †ï¼šä»»ä½•çˆ¶èŠ‚ç‚¹çš„é”®å€¼ï¼Œéƒ½å°äºç­‰äºä»»ä½•ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚
  
  ![img](https://images.xiaozhuanlan.com/photo/2020/a126cb2e0cc2fb052ea807452f78b34f.png)

##### æ’å…¥èŠ‚ç‚¹

- æ’å…¥äºŒå‰å †æ ‘çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹
- åŒ¹é…å¤§é¡¶å †/å°é¡¶å †çš„è§„åˆ™ï¼ˆä¸çˆ¶èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œä¸ç¬¦åˆè§„åˆ™ï¼Œå³è¿›è¡Œã€Œä¸Šæµ®ã€

ğŸŒ°

![img](https://images.xiaozhuanlan.com/photo/2020/23a27f159afefe41e767e4632c5d7582.png)

![img](https://images.xiaozhuanlan.com/photo/2020/52e0a2b68ea4bdbc93a5e18b2352bd2c.png)

![img](https://images.xiaozhuanlan.com/photo/2020/2cbf84bbe6fa88a5017e4f9233fd601c.png)

![img](https://images.xiaozhuanlan.com/photo/2020/40015cff0109ffe5a72b4ab8b630c253.png)

##### åˆ é™¤èŠ‚ç‚¹

åœ¨äºŒå‰å †ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åªä¼šåˆ é™¤å¤„äºå †é¡¶çš„å…ƒç´ ã€‚

- åˆ é™¤å †é¡¶å…ƒç´ 
- å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºå †é¡¶
- åŒ¹é…è§„åˆ™ï¼Œä¸ç¬¦åˆåˆ™ã€Œä¸‹æ²‰ã€

![img](https://images.xiaozhuanlan.com/photo/2020/35b106cb46cd74de68271a315ecd1f77.png)

![img](https://images.xiaozhuanlan.com/photo/2020/879be58e8641fbedfce4fa088d11d190.png)

![img](https://images.xiaozhuanlan.com/photo/2020/4e93b342480d2afe895b553f4feeb9d4.png)

![img](https://images.xiaozhuanlan.com/photo/2020/0afac613dada5911dd984f34aa1682ca.png)

##### æ„å»ºäºŒå‰å †

æ„å»ºäºŒå‰å †ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªæ’åºçš„è¿‡ç¨‹ã€‚å°†ä¸ç¬¦åˆè§„åˆ™çš„äºŒå‰æ ‘ï¼Œé€šè¿‡æ‰€æœ‰éå¶å­èŠ‚ç‚¹ä¾æ¬¡çš„ä¸‹æ²‰æ“ä½œï¼Œè°ƒæ•´æˆä¸ºäºŒå‰å †ã€‚

#### ä»£ç å®ç°

æˆ‘ä»¬é€šå¸¸åŸºäºæ•°ç»„æ¥å®ç°äºŒå‰å †ã€‚æ— è®ºæ˜¯æœ€å¤§å †ï¼Œè¿˜æ˜¯æœ€å°å †å®ƒå…¶å®éƒ½æœ‰è‡ªå·±çš„é¡ºåºã€‚å¹¶ä¸”å› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ€å¤šåªæœ‰ä¸¤ä¸ªå­å…ƒç´ ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„ä½¿ç”¨æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ¥åœ¨æ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„å­å…ƒç´ ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœçˆ¶èŠ‚ç‚¹å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¸º kï¼Œé‚£ä¹ˆå­å…ƒç´ ä¸­ï¼Œå·¦èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2k + 1ï¼Œå³å…ƒç´ çš„ä¸‹æ ‡å°±æ˜¯ 2k + 2ã€‚æœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬åœ¨æ„å»ºäºŒå‰å †æ—¶è°ƒæ•´ä½ç½®å°±å¾ˆç®€å•äº†ã€‚

##### å…¬å¼æ¨å¯¼

ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œä¸€å…±æœ‰ä¹ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä»¥ p ä»£è¡¨çˆ¶èŠ‚ç‚¹ï¼Œl ä»£è¡¨left å·¦èŠ‚ç‚¹ï¼Œr ä»£è¡¨ right å³èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ•°ç»„ä¸­ä¸‹æ ‡ä» 0 å¼€å§‹ï¼Œå¯¹åº”çš„å…³ç³»å¦‚ä¸‹

```js
p = 0, l = 1, r = 2
p = 1, l = 3, r = 4
p = 2, l = 5, r = 6
p = 3, l = 7, r = 8

// å½“å‰æ¡ˆä¾‹ä¸€å…±åªæœ‰9ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹æ›´å¤šçš„è¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æ€»ç»“
p = 4, l = 9, r = 10
p = 5, l = 11, r = 12
```

`l = 2p + 1, r = 2p +2` 

`p = Math.floor((i - 1) / 2)`

å®Œæ•´ä»£ç 

```js
class BinaryHeap {
  constructor(compare, array) {
    this.compare = compare
    if (array) {
      this.heap = array
      this.size = this.heap.length
      this.buildHeap()
    } else {
      this.heap = []
      this.size = 0
    }
  }
  // åˆ¤æ–­æ˜¯å¦ä¸ºç©º
  isEmpty() {
    return this.size == 0
  }
  // é€šè¿‡å­èŠ‚ç‚¹ä¸‹æ ‡ï¼Œè·å–èŠ‚ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹
  parentIndex(i) {
    return Math.floor((i - 1) / 2)
  }
  parent(i) {
    return this.heap[this.parentIndex(i)]
  }
  leftIndex(i) {
    return 2 * i + 1
  }
  // é€šè¿‡çˆ¶èŠ‚ç‚¹ä¸‹æ ‡ï¼Œè·å–çˆ¶èŠ‚ç‚¹çš„å·¦è¾¹å­èŠ‚ç‚¹
  left(i) {
    return this.heap[this.leftIndex(i)]
  }
  rightIndex(i) {
    return 2 * i + 2
  }
  // é€šè¿‡çˆ¶èŠ‚ç‚¹ä¸‹æ ‡ï¼Œè·å–çˆ¶èŠ‚ç‚¹çš„å³è¾¹å­èŠ‚ç‚¹
  right(i) {
    return this.heap[this.rightIndex(i)]
  }

  // èŠ‚ç‚¹äº¤æ¢
  swap(i, j) {
    const temp = this.heap[i]
    this.heap[i] = this.heap[j]
    this.heap[j] = temp
  }

  // æ’å…¥èŠ‚ç‚¹
  push(node) {
    if (this.size == 0) {
      this.size ++
      this.heap[0] = node
      return
    }
    this.size ++
    let i = this.size - 1
    this.heap[i] = node
    while(i != 0 && this.compare(this.heap[i], this.parent(i))) {
      this.swap(i, this.parentIndex(i))
      i = this.parentIndex(i)
    }
  }

  // æ— è®ºæ˜¯åˆ é™¤å…ƒç´ ï¼Œæˆ–è€…è¯´æ„å»ºäºŒå‰å †ï¼Œéƒ½éœ€è¦é‡æ–°æ’åºï¼Œå°è£…ç»Ÿä¸€çš„æ–¹æ³•æ¥æ”¯æŒæ’åºè¿‡ç¨‹ï¼Œ
  // å¶å­èŠ‚ç‚¹ä¸ä¼šè°ƒç”¨æ­¤æ–¹æ³•
  // å‘ä¸‹è°ƒæ•´
  heapify(i) {
    // æ‰¾åˆ°æœ€å°çš„å…ƒç´ 
    const l = this.leftIndex(i)
    const r = this.rightIndex(i)
    const pv = this.heap[i],
          lv = this.heap[l],
          rv = this.heap[r]

    let small = i
    if (l < this.size && this.compare(lv, pv)) {
      small = l
    }
    if (r < this.size && this.compare(rv, this.heap[small])) {
      small = r
    }

    if (small != i) {
      this.swap(i, small)
      this.heapify(small)
    }
  }

  // åˆ é™¤å †é¡¶å…ƒç´ 
  pop() {
    if (this.size <= 0) {
      return null
    }
    if (this.size == 1) {
      let node = this.heap[this.size - 1]
      this.size --
      this.heap.length = this.size
      return node
    }
    const root = this.heap[0]
    this.heap[0] = this.heap[this.size - 1]
    this.size --
    this.heap.length = this.size
    this.heapify(0)
    return root
  }

  // è·å–å †é¡¶å…ƒç´ 
  top() {
    return this.heap[0]
  }

  // æ„å»ºå †ï¼Œä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹éå†æ„å»º
  buildHeap() {
    for (let i = this.parentIndex(this.size - 1); i >= 0; i--) {
      this.heapify(i)
    }
  }
}

function compare(a, b) {
  return a < b;
}

var heap = new BinaryHeap(compare);
heap.push(1);
heap.push(2);
heap.push(3);
heap.push(4);
heap.push(5);
console.log(heap.heap) // [1, 2, 3, 4, 5]
heap.pop()
console.log(heap.heap) // [2, 4, 3, 5]

var array = [150, 80, 40, 30, 10, 70, 110, 100, 20, 90, 60, 50, 120, 140, 130]; 
var h = new BinaryHeap(compare, array);
console.log(h.heap) // [10, 20, 40, 30, 60, 50, 110, 100, 150, 90, 80, 70, 120, 140, 130]Â Â 
```
