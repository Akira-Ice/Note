# 前言

## 目标

## 准备

1. 源码下载

   `git clone https://github.com/vuejs/vue.git`

2. source map：

   在 `package.json.script` 中的 `dev` 命令中添加 `--sourcemap`，形成源码映射，便于调试。

## 扫盲

> 执行 `npm run build` 命令之后会发现 `dist` ，目录下生成了多个 `vue.*.js` 文件，各有什么含义呢？

1. 构建文件分类

   |                     | UMD                | CommonJS              | ES Module          |
   | ------------------- | ------------------ | --------------------- | ------------------ |
   | Full                | vue.js             | vue.common.js         | vue.esm.js         |
   | Runtime-only        | vue.runtime.js     | vue.runtime.common.js | vue.runtime.esm.js |
   | Full (prod)         | vue.min.js         | vue.common.prod.js    |                    |
   | Runtime-only (prod) | vue.runtime.min.js | vue.runtime.common.js |                    |

   

2. 名词解释

   - **Full：** 全量包，包含编译器`(complier)`和运行`(runtime)`时。
   - **Compiler：**编译器，负责讲模板字符串编译为 `JavaScript` 语法的 `rander` 函数。
   - **Runtime：**负责创建 `Vue` 实例、渲染函数、`path` 虚拟 `DOM` 等，基本上除了编译器之外的代码都属于运行时代码。
   - **UMD：**兼容 `CommonJS` 和 `AMD` 规范。
   - **CommonJS：**经典 `nodeJS` 规范。

## 源码目录结构

通过目录结构的阅读，对源码有一个大致的了解，知道哪些东西需要去哪看。

```shell
├── benchmarks                  性能、基准测试
├── dist                        构建打包的输出目录
├── examples                    案例目录
├── flow                        flow 语法的类型声明
├── packages                    一些额外的包，比如：负责服务端渲染的包 vue-server-renderer、配合 vue-loader 使用的的 vue-template-compiler，还有 weex 相关的
│   ├── vue-server-renderer
│   ├── vue-template-compiler
│   ├── weex-template-compiler
│   └── weex-vue-framework
├── scripts                     所有的配置文件的存放位置，比如 rollup 的配置文件
├── src                         vue 源码目录
│   ├── compiler                编译器
│   ├── core                    运行时的核心包
│   │   ├── components          全局组件，比如 keep-alive
│   │   ├── config.js           一些默认配置项
│   │   ├── global-api          全局 API，比如熟悉的：Vue.use()、Vue.component() 等
│   │   ├── instance            Vue 实例相关的，比如 Vue 构造函数就在这个目录下
│   │   ├── observer            响应式原理
│   │   ├── util                工具方法
│   │   └── vdom                虚拟 DOM 相关，比如熟悉的 patch 算法就在这儿
│   ├── platforms               平台相关的编译器代码
│   │   ├── web
│   │   └── weex
│   ├── server                  服务端渲染相关
├── test                        测试目录
├── types                       TS 类型声明
```

